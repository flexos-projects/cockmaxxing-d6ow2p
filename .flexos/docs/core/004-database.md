---
id: 004-database
title: Database Schema
description: Detailed specification of the Firestore collections, fields, data types, and relationships that power the application.
type: doc
subtype: core
status: draft
sequence: 4
tags:
  - database
  - firestore
  - technical
createdAt: "2023-10-27T10:00:00Z"
updatedAt: "2023-10-27T10:00:00Z"
---

## 1. Introduction

This document outlines the data architecture for COCKMAXXING, which will be implemented using Google Firebase's Firestore, a NoSQL document database. The schema is designed to be scalable, secure, and efficient, with a clear separation of public and private user data. All `id` fields will be auto-generated by Firestore unless otherwise specified. Timestamps will be stored using Firestore's native `Timestamp` type.

## 2. Core Collections

### 2.1. `users`

Stores public profile information, authentication details, and personalized settings for each user. The document ID for this collection will be the user's UID from Firebase Authentication.

*   **`id`** (string, required): Firebase Authentication UID.
*   **`email`** (email, required): User's email for authentication.
*   **`username`** (string, required): The anonymous display name used throughout the community. Must be unique.
*   **`created_at`** (date, required): Timestamp of account creation.
*   **`avatar_url`** (url, optional): URL to a user-uploaded profile image, likely stored in Firebase Storage.
*   **`bio`** (richtext, optional): A short user-written biography for their profile page.
*   **`privacy_settings`** (object, required): A map of privacy controls. 
    *   Example: `{ profile_visibility: 'public', measurements_visible_to_all: false }`
*   **`notification_preferences`** (object, required): User-defined toggles for notifications.
    *   Example: `{ forum_replies: true, private_messages: true }`
*   **`roles`** (array, required): Defines user permissions. Default is `['member']`. Other roles include `['moderator', 'admin']`.

### 2.2. `posts`

Stores the top-level forum threads created by users.

*   **`id`** (string, required): Unique post ID.
*   **`author_id`** (reference, required): A reference to the `users` document of the author (their UID).
*   **`title`** (string, required): The title of the forum thread.
*   **`content`** (richtext, required): The main body content of the post.
*   **`category`** (enum, required): The forum category, e.g., `'Beginner Routines'`, `'Safety & Health'`. This will be used for filtering on the **Community Forums Page**.
*   **`created_at`** (date, required): Timestamp of post creation.
*   **`updated_at`** (date, optional): Timestamp of the last edit.
*   **`comment_count`** (number, required): A denormalized count of comments for efficient querying, initialized to `0`.
*   **`tags`** (array, optional): An array of strings for fine-grained topic classification, e.g., `['jelqing', 'pumping']`.

### 2.3. `comments`

Stores replies to `posts`. This will be a subcollection under each `post` document for scalability (`posts/{postId}/comments/{commentId}`).

*   **`id`** (string, required): Unique comment ID.
*   **`author_id`** (reference, required): A reference to the `users` document of the commenter.
*   **`content`** (richtext, required): The text of the reply.
*   **`created_at`** (date, required): Timestamp of comment creation.

### 2.4. `progress_entries`

Stores the private, sensitive progress data for each user. Firestore security rules will be critical here, ensuring a user can only read and write their own documents.

*   **`id`** (string, required): Unique entry ID.
*   **`user_id`** (reference, required): A reference to the `users` document (UID) that owns this entry. This field is essential for security rules.
*   **`date`** (date, required): The specific date the entry is for, allowing for chronological sorting and charting.
*   **`measurements`** (object, required): A map of numerical measurement data.
    *   Example: `{ length_erect: 7.0, girth_midshaft: 5.0, unit: 'in' }`
*   **`routine_details`** (richtext, optional): A description of the exercises performed.
*   **`notes`** (richtext, optional): Any personal notes or observations.
*   **`private_photo_urls`** (array, optional): An array of secure URLs pointing to images in Firebase Storage. Access will be controlled via security rules.
*   **`created_at`** (date, required): Timestamp when the entry was logged.

### 2.5. `resources`

Stores the curated content for the **Resource Library**.

*   **`id`** (string, required): Unique resource ID.
*   **`title`** (string, required): The title of the article or guide.
*   **`type`** (enum, required): The format of the resource, e.g., `'article'`, `'guide'`, `'video'`.
*   **`content`** (richtext, required): The full body of the resource.
*   **`category`** (enum, required): The main category, e.g., `'Techniques'`, `'Anatomy'`, `'Psychology'`.
*   **`published_at`** (date, required): The date the resource was published or last reviewed.
*   **`tags`** (array, optional): Keywords for searching and filtering.